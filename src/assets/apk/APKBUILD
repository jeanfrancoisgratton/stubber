# Maintainer: {{ MAINTAINER }}
# Packager: {{ PACKAGER }}
pkgname={{ SOFTWARE NAME }}
pkgver={{ PACKAGE VERSION }}
pkgrel={{ PACKAGE RELEASE }}
pkgdir=/data/packages
pkgdesc="{{ DESCRIPTION }}"
url="{{ URL }}"
arch=x86_64
license=GPL2
#depends="gcompat"
install="$pkgname.pre-install $pkgname.post-install $pkgname.pre-upgrade $pkgname.post-upgrade $pkgname.pre-deinstall $pkgname.post-deinstall"
#source="$pkgname-$pkgver-$pkgrel.tar.bz2::http://localhost/$pkgname-$pkgver-$pkgrel.tar.bz2"
builddir="$startdir/src/BUILD"

binaryname={{ BINARY NAME }}

prepare() {
	mkdir -p "$builddir"
	cp -R "$startdir"/../src/* "$builddir"/
}

build() {
	cd "$builddir"

	go env | egrep 'GOFLAGS|CGO_ENABLED|GOOS|GOARCH' || true

	# Static, non-PIE, internal linker
	go build -trimpath -ldflags="-s -w -buildid= -linkmode=internal" -o "$binaryname" .
}

package() {
	install -d "$pkgdir"/opt/bin
	install -m755 "$builddir/$binaryname" "$pkgdir/opt/bin/$binaryname"
}