<H1>stubber</H1>

Tool to create the directory structure to build and package a GO software using my current CI-CD infra.
<br><br>

*A note about this file* : for some weird reason, I can edit this file many times over, with trivial changes, and the Markdown rendering would break, then another trivial change and the rendering is OK, and so on. Apologies for that, but I won't waste time on cosmetic issues like that.
____

<H2>How does it work</H2>
You use this tool to create the directory structure of a GO software according to my own CI-CD pipeline.
All files come from templated files and are generated in order to replace placeholders in the templates with values provided at run-time.

Basically, you provide values (using the various built-in flags) and all the necessary files will be created

Below is a directory tree of the files that would be generated by the tool (when all flags are enabled)
```
.
├── __alpine
│   ├── APKBUILD
│   └── Makefile
├── __debian
│   ├── 1.install-build-deps.sh
│   ├── 2.build_binary.sh
│   ├── 3.restore_repo.sh
│   ├── control
│   ├── current_pkg_release
│   └── preinst
│   └── postinst
│   └── prerm
│   └── postrm
├── FIXME.md
├── go.version
├── IN THIS BRANCH.md
├── LICENSE
├── PACKAGING.md
├── README.md
├── ROADMAP.md
├── rpmbuild-deps.sh
├── src
│   ├── build.sh
│   ├── cmd
│   │   └── root.go
│   ├── go.mod
│   ├── main.go
│   └── upgrade_pkgs.sh
├── <SOFTWARENAME>.spec
└── TODO.md
```

All sections (also called stubs) are generated this way:

| Stub          | Flag | File or directory                             |
|---------------|------|-----------------------------------------------|
| apk packaging | -a   | __alpine/                                     |
| deb packaging | -d   | __debian/                                     |
| rpm packaging | -r   | src/rpm-install-build.sh<br/>src/stubber.spec |
| skeleton      | -k   | All other files under src and src/cmd         |

All other flags (see `stubber -h` and `stubber create -h`) provide values to pass to the generated files.<br>
All templated files are embedded into `src/templates/assets.go` . The files were generated from `src/assets/` using the build script in `src/build.sh`

<H2>Building from source</H2>
Simple steps:<br>
- Clone this repo<br>
- Modify all the templated files in src/assets/ according to your tastes<br>
- Run: `build.sh`, from the src/ directory<br>

<H2>Building packages</H2>
Instructions are provided in [PACKAGING.md](PACKAGING.md)
The instructions provided in that file are for use with my own build containers, which are not yet published as they rely too heavily on my own infra at home.<br>
In the meantime, you can use the packages under the Releases link herein.

<H2>Issues, caveats, etc</H2>
- This software creates a directory structure, but does **not** create a git repo (maybe some future version ? A Perforce repo, too, while at it ?)<br>
- Sometimes `go.mod/go.sum` just do not work properly and might need a re-initialization (`go mod init`). I haven't yet isolated the cause of this misbehaviour. Because of this, running `./build.sh` from the `src/` directory right after execution of this tool might or might not work without `go.{mod,sum}` thinkering.<br>
- This software is mainly geared for X86_64 and AMD64 architectures. I've had limited opportunities to test it on other architectures (briefly tested on a Mac M1's arm64 arch). This means that some files might need extra tweaking after execution.<br>
- **Always**, **always**, **always** (did I mention: always ?) review the generated files after execution. This tool is a generic tool to create stubs, and update them (version bumps, etc) later, but again: *generic tool*.<br>
